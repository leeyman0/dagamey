<!DOCTYPE html>
<html>
  <head>
    <title>Lesson Window</title>
  </head>
  <body>
    <div id="game_window"></div>
    <p id="ID">
    </p>
    <script src="./dagamey.js"></script>
    <script src="./jquery-3.6.0.min.js"></script>
    <script>
      // This is where the code that connects the database to the game engine to the website is
      let exit_button = document.createElement("button");
      exit_button.id = "exit_button";
      let game_window = document.getElementById("game_window");
      // First, supply the selection of the lesson
      // All we really need to retrieve is the number of lessons in the database
      // Some user data would be nice as well, like the completion level
      let database_data;
      //      window.addEventListener("load", function () {
      //	  let database_request = new XMLHttpRequest();
      //	  database_request.open("POST", "1b-database.php");
      //	  database_request.onLoad(function () {
      //	      // something something something
      //	  });
      //      });
      
      let ID = -1;
      window.addEventListener("load", getUserId);
      function getUserId() {
	  $.post("get_user_id.php", function(user_id) {
              //console.log("hello 1\n");
              ID = user_id;
              document.getElementById("ID").innerHTML = `Hello, user number ${ID}`;
              //console.log("hello 2\n");
          });
      }

      function checkID() {
	  $.post("check_ID.php",
		 {
		     ID,
		     success: function (response) {        //get response from your php page (what you echo or print)
			 console.log(response);
			 if (response === 'false') {
			     createGameRow();
			 }
		     }
		 }
		);
      }
      function createGameRow() {
	  $.post("make_user_row.php", {ID});
      }

      function getLevel() {
	  $.post("get_level.php",
		 {ID},
		 function(response) {
		     current_level = response.level; //Adjust to how level is implmented
		     document.getElementById("level").innerHTML = response.level; //set the level in html
		 }, 'json');
      }

      function setLevel() {
	  $.post("set_level.php",
		 {
		     ID,
		     level,
		 });
	  getLevel(); //this will make sure the latest level is displayed
      }
      // Perhaps a name would be nice too
      let lesson_selection = document.createElement("div");

      function select_lesson(index) {
	  
      }
      
      for (let i = 1; i <= 10; i++)
      {
	  let current_lesson = document.createElement("div");
	  current_lesson["class"] = "lesson_choice";
	  current_lesson.innerHTML = `<h3>Lesson ${i}</h3>`;
	  current_lesson.addEventListener("click", function () {
	      // Display the lesson on the webpage using levelData
	      select_lesson(i);
	  });
      }
      // The submit button submits the lesson data
      exit_button.addEventListener("click", function () {
	  // This is where the code to submit to the database goes

	  // It returns us to the lesson selection screen
	  game_window.innerHTML = "";
	  game_window.appendChild(lesson_selection);
	  
      });
    </script>
  </body>
</html>
