<!DOCTYPE html>
<html>
  <head>
    <title>Lesson Window</title>
    <meta charset="UTF-8">
    <style>
      * {
	  text-align : center;
	  font-family : Arial;
      }
    </style>
  </head>
  <body>
    <div id="game_window"></div>
    <p id="ID">
    </p>
    <script src="./dagamey.js"></script>
    <script src="./jquery-3.6.0.min.js"></script>
    <script>
      // This is where the code that connects the database to the game engine to the website is
      let exit_button = document.createElement("button");
      exit_button.id = "exit_button";
      let game_window = document.getElementById("game_window");
      // First, supply the selection of the lesson
      // All we really need to retrieve is the number of lessons in the database
      // Some user data would be nice as well, like the completion level
      let database_data;
      //      window.addEventListener("load", function () {
      //	  let database_request = new XMLHttpRequest();
      //	  database_request.open("POST", "1b-database.php");
      //	  database_request.onLoad(function () {
      //	      // something something something
      //	  });
      //      });
      
      let ID = -1;
      window.addEventListener("load", getUserId);
      function getUserId() {
	  $.post("get_user_id.php", function(user_id) {
              //console.log("hello 1\n");
              ID = user_id;
              console.log(`Hello, user number ${ID}`);
              //console.log("hello 2\n");
          });
      }

      // This function checks the ID of the user
      // Either creates a game row if there is no data
      // or it gets the user's data
      function checkID() {
	  $.post("check_ID.php",
		 {
		     ID,
		 },
		 function (response) {
		     console.log(response);
		     if (response === 'false') {
			 createGameRow();
		     }
		 });
      }
      function load_level(lesson, level) {
	  $.post("load_level.php",
		 {
		     lesson,
		     level,
		 },
		 function (response) {
		     console.log(response);
		 }, 'json');
      }
      
      // Create data for a user
      function createGameRow() {
	  $.post("make_user_row.php", {ID});
      }

      // This does not get a level, it should be named something different
      function getUserLevel() {
	  let level_nr;
	  $.post("get_level.php",
		 {ID},
		 function(response) {
		     level = response.level; 
		     document.getElementById("progress").innerHTML = response.level;
		 }, 'json');
	  return level_nr;
      }

      function setUserLevel() {
	  $.post("set_level.php",
		 {
		     ID,
		     level,
		 });
	  getUserLevel(); //this will make sure the latest level is displayed
      }
      // Perhaps a name would be nice too
      let lesson_selection = document.createElement("div");

      let num_lessons = 10;
      function make_lesson_selection(lesson_title, lesson_nr, levels_nr, level_offset) {
	  let lesson_selection_box = document.createElement("div");
	  level_selection_box["class"] = "lessonselectitem";
	  // Making a div for the selection box
	  let selection_title = document.createElement("div");
	  selection_title["class"] = "lessontitle";
	  selection_title.innerHTML = lesson_title;

	  // adding functionality to it
	  lesson_selection_box.addEventListener("click", function () {
	      load_level(i, level_offset);
	      
	  });
	  
	  return lesson_selection_box;
      }

      // Generating the boxes for all 10 levels
      for (let i = 1; i <= num_lessons; i++) {
	  let current_lesson_select = make_lesson_selection(`Lesson ${i}`, i, 3, 1)
	  lesson_selection.appendChild(current_lesson_select);
      }
      
      // The submit button submits the lesson data
      exit_button.addEventListener("click", function () {
	  // This is where the code to submit to the database goes

	  // It returns us to the lesson selection screen
	  game_window.innerHTML = "";
	  game_window.appendChild(lesson_selection);
	  
      });
    </script>
  </body>
</html>
